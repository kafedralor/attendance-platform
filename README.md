# Платформа показа посещаемости

Данные берутся из Google Таблицы (листы **Сотрудники** и **Посещения**) и отображаются на веб-платформе. Передача данных идёт через URL веб-приложения Apps Script.

---

## 1. Скрипт в Google Таблице

У вас уже есть скрипт с `doGet` и `doPost`. В одном проекте может быть только один `doGet`, поэтому **новый код нужно встроить в существующий скрипт**.

### Что сделать

1. Откройте вашу Google Таблицу → **Расширения** → **Apps Script**.
2. В функции **`doGet(e)`** добавьте в самое начало проверку на `action === "display"`:
   - если `action === "display"`, вызовите `getDataForDisplay()` и верните результат через `return responseWithCors(result);`
   - при ошибке: `return responseWithCors({ ok: false, error: err.toString() });`
3. В конец проекта скопируйте все функции из файла **`GoogleAppsScript/ВставитьВСуществующийСкрипт.gs`** (функции `responseWithCors`, `getDataForDisplay`, `readEmployeesForDisplay`, `readVisitsForDisplay`).
4. Сохраните проект (Ctrl+S). Развертывание не меняйте — используйте тот же URL веб-приложения.

### Развертывание веб-приложения

1. В редакторе Apps Script: **Развернуть** → **Новое развертывание**.
2. Тип: **Веб-приложение**.
3. **Описание:** например, «Данные для платформы посещаемости».
4. **Запуск от имени:** я (ваш аккаунт).
5. **Доступ:** **Все пользователи** (или «Только я», если платформа будет открываться только у вас).
6. Нажмите **Развернуть**.
7. Скопируйте **URL веб-приложения** (например, `https://script.google.com/macros/s/.../exec`) — он понадобится для платформы.

### Вызов из другого скрипта таблицы

Если у вас уже есть скрипт в таблице и вы хотите передавать данные на платформу по своему URL:

- Данные для показа возвращает функция **`getDataForDisplay()`**.
- Результат: объект с полями `employees` и `visits`.
- Ваш скрипт может вызывать `getDataForDisplay()`, формировать свой URL (например, с base64-данными) и открывать платформу в новой вкладке с параметром `?url=...` (URL веб-приложения).

Пример открытия платформы с уже подставленным URL данных:

```javascript
// В вашем существующем скрипте:
var webAppUrl = 'https://script.google.com/macros/s/ВАШ_ID/exec';
var platformUrl = 'https://ваш-хостинг/platform/index.html?url=' + encodeURIComponent(webAppUrl);
// Открыть в новой вкладке или показать на экране:
// SpreadsheetApp.getUi().showModalDialog(..., platformUrl);
```

---

## 2. Платформа показа

### Запуск

- Откройте файл **`platform/index.html`** в браузере (двойной клик или «Открыть с помощью» → браузер).

Либо поднимите локальный сервер в папке проекта, например:

```bash
# Python 3
python -m http.server 8080
# Откройте http://localhost:8080/platform/
```

### Настройка

URL веб-приложения задаётся в коде: в файле **`platform/js/data.js`** (переменная `DATA_URL`). Подставьте свой URL развертывания (оканчивается на `/exec`). Данные автоматически обновляются каждые 30 секунд.

### Передача URL через ссылку

Платформу можно открыть с уже подставленным URL данных:

```
file:///.../platform/index.html?url=https://script.google.com/macros/s/ВАШ_ID/exec
```

Или на хостинге:

```
https://ваш-сайт/platform/?url=https://script.google.com/...
```

---

## Структура данных

- **Сотрудники:** ID, ФИО, Подразделение, Должность, Комментарий, Дата создания, Фото (URL).
- **Посещения:** ID события, ID сотрудника, ФИО, Действие (Приход/Уход), Время, Устройство.

Платформа показывает последние посещения и список сотрудников с индикатором «На работе» / «Нет» по последнему действию (Приход/Уход).

---

## 3. Деплой на GitHub (GitHub Pages)

Чтобы выложить платформу в интернет через GitHub Pages:

1. **Создайте репозиторий** на [GitHub](https://github.com/new) (например, `attendance-platform`).

2. **Инициализируйте Git и загрузите проект** (в корне проекта):

   ```bash
   git init
   git add .
   git commit -m "Платформа посещаемости"
   git branch -M main
   git remote add origin https://github.com/ВАШ_ЛОГИН/attendance-platform.git
   git push -u origin main
   ```

3. **Включите GitHub Pages:**
   - В репозитории: **Settings** → **Pages**.
   - **Source:** Deploy from a branch.
   - **Branch:** `main`, папка **/docs**.
   - Сохраните (Save).

4. Сайт будет доступен по адресу:  
   **`https://ВАШ_ЛОГИН.github.io/attendance-platform/`**

Для своей таблицы замените URL в **`docs/js/data.js`** (переменная `DATA_URL`) на URL вашего веб-приложения Apps Script.
